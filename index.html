<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Sistem Laporan Bulanan</title>
  
  <!-- AdminLTE 3 CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <!-- XLSX -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
  <style>
    .brand-text { font-weight: 700 !important; }
    .content-wrapper { background: #f4f6f9; }
    .small-box { border-radius: 0.5rem; }
    .info-box { border-radius: 0.5rem; }
    .card { border-radius: 0.5rem; box-shadow: 0 0 1px rgba(0,0,0,.125), 0 1px 3px rgba(0,0,0,.2); }
    .main-sidebar { box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22); }
    @media print {
      .no-print { display: none !important; }
      .content-wrapper { background: white !important; }
    }
  </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light no-print">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">Dashboard Utama</a>
      </li>
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Log Keluar
        </a>
      </li>
    </ul>
  </nav>

  <!-- Main Sidebar -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4 no-print">
    <!-- Brand Logo -->
    <a href="#" class="brand-link">
      <i class="fas fa-chart-line brand-image ml-3" style="opacity: .8"></i>
      <span class="brand-text font-weight-light">Dashboard Bahagian</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user panel -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <i class="fas fa-user-circle fa-2x text-white"></i>
        </div>
        <div class="info">
          <a href="#" class="d-block" id="sidebarUsername">Admin User</a>
          <small class="text-muted" id="sidebarRole">Administrator</small>
        </div>
      </div>

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu">
          <li class="nav-item">
            <a href="#" class="nav-link active" onclick="showPage('dashboard')">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>Dashboard Utama</p>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" onclick="showPage('settings')">
              <i class="nav-icon fas fa-cog"></i>
              <p>Tetapan</p>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" onclick="showPage('report')">
              <i class="nav-icon fas fa-file-alt"></i>
              <p>Laporan</p>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" onclick="showPage('summary')">
              <i class="nav-icon fas fa-table"></i>
              <p>Data Tahunan</p>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" onclick="showPage('archive')">
              <i class="nav-icon fas fa-archive"></i>
              <p>Arkib</p>
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" onclick="showPage('users')">
              <i class="nav-icon fas fa-users"></i>
              <p>Pengguna</p>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </aside>

  <!-- Content Wrapper -->
  <div class="content-wrapper">
    
    <!-- Dashboard Page -->
    <div id="dashboardPage" class="page-content">
      <!-- Content Header -->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0">Dashboard Utama</h1>
            </div>
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">Dashboard</li>
              </ol>
            </div>
          </div>
        </div>
      </div>

      <!-- Main content -->
      <section class="content">
        <div class="container-fluid">
          <!-- Info boxes -->
          <div class="row">
            <div class="col-12 col-sm-6 col-md-3">
              <div class="info-box">
                <span class="info-box-icon bg-info elevation-1"><i class="fas fa-book"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Total Seksyen</span>
                  <span class="info-box-number" id="totalSections">0</span>
                </div>
              </div>
            </div>
            <div class="col-12 col-sm-6 col-md-3">
              <div class="info-box mb-3">
                <span class="info-box-icon bg-success elevation-1"><i class="fas fa-calendar"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Bulan Semasa</span>
                  <span class="info-box-number" id="currentMonth">Januari</span>
                </div>
              </div>
            </div>
            <div class="col-12 col-sm-6 col-md-3">
              <div class="info-box mb-3">
                <span class="info-box-icon bg-warning elevation-1"><i class="fas fa-archive"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Arkib</span>
                  <span class="info-box-number" id="totalArchive">0</span>
                </div>
              </div>
            </div>
            <div class="col-12 col-sm-6 col-md-3">
              <div class="info-box mb-3">
                <span class="info-box-icon bg-danger elevation-1"><i class="fas fa-users"></i></span>
                <div class="info-box-content">
                  <span class="info-box-text">Pengguna</span>
                  <span class="info-box-number" id="totalUsers">2</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Charts -->
          <div class="row">
            <div class="col-lg-6">
              <div class="card">
                <div class="card-header border-0">
                  <div class="d-flex justify-content-between">
                    <h3 class="card-title">Statistik Bulanan</h3>
                  </div>
                </div>
                <div class="card-body">
                  <div style="height: 250px;">
                    <canvas id="monthlyChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-6">
              <div class="card">
                <div class="card-header border-0">
                  <h3 class="card-title">Trend Tahunan</h3>
                </div>
                <div class="card-body">
                  <div style="height: 250px;">
                    <canvas id="yearlyChart"></canvas>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="row">
            <div class="col-lg-12">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Aktiviti Terkini</h3>
                </div>
                <div class="card-body p-0">
                  <div class="table-responsive">
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th>Masa</th>
                          <th>Pengguna</th>
                          <th>Aktiviti</th>
                        </tr>
                      </thead>
                      <tbody id="activityTable">
                        <tr>
                          <td colspan="3" class="text-center text-muted">Tiada aktiviti</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Settings Page -->
    <div id="settingsPage" class="page-content" style="display: none;">
      <div class="content-header">
        <div class="container-fluid">
          <h1 class="m-0">Tetapan Organisasi</h1>
        </div>
      </div>
      <section class="content">
        <div class="container-fluid">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Maklumat Header Laporan</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label>Bahagian / Unit</label>
                <input type="text" class="form-control" id="orgDepartment" value="BAHAGIAN SIRKULASI">
              </div>
              <div class="form-group">
                <label>Nama Organisasi</label>
                <input type="text" class="form-control" id="orgName" value="PERPUSTAKAAN HAMZAH SENDUT">
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Bulan</label>
                    <select class="form-control" id="monthSelect"></select>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Tahun</label>
                    <select class="form-control" id="yearSelect">
                      <option>2026</option>
                      <option>2025</option>
                      <option>2024</option>
                    </select>
                  </div>
                </div>
              </div>
              <button class="btn btn-primary" onclick="saveSettings()">
                <i class="fas fa-save"></i> Simpan
              </button>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Seksyen Laporan</h3>
              <div class="card-tools">
                <button class="btn btn-success btn-sm" onclick="addSection()">
                  <i class="fas fa-plus"></i> Tambah Seksyen
                </button>
              </div>
            </div>
            <div class="card-body">
              <div id="sectionsList"></div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Report Page -->
    <div id="reportPage" class="page-content" style="display: none;">
      <div class="content-header">
        <div class="container-fluid">
          <h1 class="m-0">Laporan Bulanan</h1>
        </div>
      </div>
      <section class="content">
        <div class="container-fluid">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title" id="reportTitle">LAPORAN BULANAN JANUARI 2026</h3>
              <div class="card-tools no-print">
                <button class="btn btn-sm btn-primary" onclick="window.print()">
                  <i class="fas fa-print"></i> Print
                </button>
                <button class="btn btn-sm btn-success" onclick="exportToExcel()">
                  <i class="fas fa-file-excel"></i> Excel
                </button>
              </div>
            </div>
            <div class="card-body">
              <div id="reportContent"></div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- Summary Page -->
    <div id="summaryPage" class="page-content" style="display: none;">
      <div class="content-header">
        <div class="container-fluid">
          <h1 class="m-0">Data Tahunan</h1>
        </div>
      </div>
      <section class="content">
        <div class="container-fluid">
          <div id="summaryContent"></div>
        </div>
      </section>
    </div>

    <!-- Archive Page -->
    <div id="archivePage" class="page-content" style="display: none;">
      <div class="content-header">
        <div class="container-fluid">
          <h1 class="m-0">Arkib Laporan</h1>
        </div>
      </div>
      <section class="content">
        <div class="container-fluid">
          <div id="archiveList" class="row"></div>
        </div>
      </section>
    </div>

    <!-- Users Page -->
    <div id="usersPage" class="page-content" style="display: none;">
      <div class="content-header">
        <div class="container-fluid">
          <h1 class="m-0">Pengurusan Pengguna</h1>
        </div>
      </div>
      <section class="content">
        <div class="container-fluid">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Senarai Pengguna</h3>
            </div>
            <div class="card-body">
              <div id="usersList"></div>
            </div>
          </div>
        </div>
      </section>
    </div>

  </div>

  <!-- Footer -->
  <footer class="main-footer no-print">
    <strong>Dashboard Bahagian &copy; 2026</strong> - Sistem Laporan Bulanan
    <div class="float-right d-none d-sm-inline-block">
      <b>Version</b> 1.0.0
    </div>
  </footer>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap 4 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>

<script>
Chart.register(ChartDataLabels);

const months = ["Januari", "Februari", "Mac", "April", "Mei", "Jun", "Julai", "Ogos", "September", "Oktober", "November", "Disember"];

let users = JSON.parse(localStorage.getItem('admin_users')) || [
  { username: 'admin', password: 'admin123', role: 'admin' },
  { username: 'editor', password: 'edit123', role: 'editor' }
];

let currentUser = { username: 'admin', role: 'admin' };
let settings = JSON.parse(localStorage.getItem('admin_settings')) || {
  department: 'BAHAGIAN SIRKULASI',
  orgName: 'PERPUSTAKAAN HAMZAH SENDUT',
  month: 'Januari',
  year: '2026'
};

let sections = JSON.parse(localStorage.getItem('admin_sections')) || [];
let archive = JSON.parse(localStorage.getItem('admin_archive')) || [];
let activityLog = JSON.parse(localStorage.getItem('admin_activity')) || [];

function init() {
  // Populate month selector
  const monthSelect = document.getElementById('monthSelect');
  months.forEach(m => {
    const option = document.createElement('option');
    option.value = m;
    option.textContent = m;
    monthSelect.appendChild(option);
  });
  monthSelect.value = settings.month;
  
  document.getElementById('yearSelect').value = settings.year;
  document.getElementById('orgDepartment').value = settings.department;
  document.getElementById('orgName').value = settings.orgName;
  
  updateDashboard();
  renderSectionsList();
}

function showPage(page) {
  // Hide all pages
  document.querySelectorAll('.page-content').forEach(p => p.style.display = 'none');
  
  // Remove active class from all nav links
  document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
  
  // Show selected page
  document.getElementById(page + 'Page').style.display = 'block';
  
  // Add active class to clicked nav link
  event.target.closest('.nav-link').classList.add('active');
  
  // Render content based on page
  if(page === 'dashboard') updateDashboard();
  if(page === 'report') renderReport();
  if(page === 'summary') renderSummary();
  if(page === 'archive') renderArchive();
  if(page === 'users') renderUsers();
}

function updateDashboard() {
  document.getElementById('totalSections').textContent = sections.length;
  document.getElementById('currentMonth').textContent = settings.month;
  document.getElementById('totalArchive').textContent = archive.length;
  document.getElementById('totalUsers').textContent = users.length;
  
  renderDashboardCharts();
  renderActivityLog();
}

function renderDashboardCharts() {
  // Monthly Chart
  const monthlyCtx = document.getElementById('monthlyChart');
  if(monthlyCtx) {
    new Chart(monthlyCtx, {
      type: 'bar',
      data: {
        labels: sections.map((s, i) => `Seksyen ${String.fromCharCode(65+i)}`),
        datasets: [{
          label: 'Total',
          data: sections.map(s => {
            if(!s.data || !s.data[settings.month]) return 0;
            return s.data[settings.month].reduce((sum, row) => sum + (row.val || 0), 0);
          }),
          backgroundColor: 'rgba(54, 162, 235, 0.8)'
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } }
      }
    });
  }
  
  // Yearly Chart
  const yearlyCtx = document.getElementById('yearlyChart');
  if(yearlyCtx) {
    new Chart(yearlyCtx, {
      type: 'line',
      data: {
        labels: months,
        datasets: [{
          label: 'Trend',
          data: months.map((m, i) => Math.floor(Math.random() * 1000)),
          borderColor: 'rgba(75, 192, 192, 1)',
          tension: 0.4,
          fill: false
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: true } }
      }
    });
  }
}

function renderActivityLog() {
  const table = document.getElementById('activityTable');
  if(activityLog.length === 0) {
    table.innerHTML = '<tr><td colspan="3" class="text-center text-muted">Tiada aktiviti</td></tr>';
    return;
  }
  
  table.innerHTML = activityLog.slice(0, 10).map(log => {
    const date = new Date(log.timestamp);
    return `
      <tr>
        <td><small>${date.toLocaleString('ms-MY')}</small></td>
        <td>${log.user}</td>
        <td>${log.action}</td>
      </tr>
    `;
  }).join('');
}

function saveSettings() {
  settings.department = document.getElementById('orgDepartment').value;
  settings.orgName = document.getElementById('orgName').value;
  settings.month = document.getElementById('monthSelect').value;
  settings.year = document.getElementById('yearSelect').value;
  
  localStorage.setItem('admin_settings', JSON.stringify(settings));
  
  Swal.fire({
    icon: 'success',
    title: 'Berjaya!',
    text: 'Tetapan telah disimpan',
    timer: 1500
  });
  
  updateDashboard();
}

function addSection() {
  const newSection = {
    id: 'sec_' + Date.now(),
    title: 'SEKSYEN BARU',
    data: {}
  };
  
  months.forEach(m => {
    newSection.data[m] = [
      { kategori: 'Item 1', val: 0 },
      { kategori: 'Item 2', val: 0 }
    ];
  });
  
  sections.push(newSection);
  localStorage.setItem('admin_sections', JSON.stringify(sections));
  renderSectionsList();
  updateDashboard();
}

function renderSectionsList() {
  const container = document.getElementById('sectionsList');
  if(sections.length === 0) {
    container.innerHTML = '<p class="text-muted">Tiada seksyen. Klik "Tambah Seksyen" untuk mula.</p>';
    return;
  }
  
  container.innerHTML = sections.map((sec, idx) => `
    <div class="card mb-2">
      <div class="card-body p-2">
        <div class="d-flex justify-content-between align-items-center">
          <strong>${String.fromCharCode(65+idx)}. ${sec.title}</strong>
          <div>
            <button class="btn btn-sm btn-danger" onclick="deleteSection(${idx})">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  `).join('');
}

function deleteSection(idx) {
  if(confirm('Padam seksyen ini?')) {
    sections.splice(idx, 1);
    localStorage.setItem('admin_sections', JSON.stringify(sections));
    renderSectionsList();
    updateDashboard();
  }
}

function renderReport() {
  const content = document.getElementById('reportContent');
  content.innerHTML = '<p class="text-muted">Laporan akan dipaparkan di sini...</p>';
}

function renderSummary() {
  const content = document.getElementById('summaryContent');
  content.innerHTML = '<p class="text-muted">Data tahunan akan dipaparkan di sini...</p>';
}

function renderArchive() {
  const list = document.getElementById('archiveList');
  if(archive.length === 0) {
    list.innerHTML = '<div class="col-12"><p class="text-muted">Tiada arkib.</p></div>';
    return;
  }
  
  list.innerHTML = archive.map((item, idx) => `
    <div class="col-md-4">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">${item.month} ${item.year}</h5>
          <p class="card-text"><small>${item.department}</small></p>
          <button class="btn btn-sm btn-primary" onclick="loadArchive(${idx})">Muat</button>
          <button class="btn btn-sm btn-danger" onclick="deleteArchive(${idx})">Padam</button>
        </div>
      </div>
    </div>
  `).join('');
}

function renderUsers() {
  const list = document.getElementById('usersList');
  list.innerHTML = users.map((user, idx) => `
    <div class="card mb-2">
      <div class="card-body p-2">
        <div class="d-flex justify-content-between">
          <div>
            <strong>${user.username}</strong>
            <span class="badge badge-${user.role === 'admin' ? 'danger' : 'info'}">${user.role}</span>
          </div>
          ${user.username !== 'admin' ? `
            <button class="btn btn-sm btn-danger" onclick="deleteUser(${idx})">
              <i class="fas fa-trash"></i>
            </button>
          ` : ''}
        </div>
      </div>
    </div>
  `).join('');
}

function exportToExcel() {
  alert('Export Excel akan dilaksanakan...');
}

function logout() {
  if(confirm('Log keluar?')) {
    window.location.reload();
  }
}

// Initialize on load
init();
</script>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</body>
</html>
